Final Project Folder Structure â€” production-ready, edge-first, guardrail-first ğŸ“‚âš¡ï¸

Nice â€” hereâ€™s a complete, opinionated repo layout you can drop into your horase-racing-rag repo. It matches everything we agreed: Vite + TS + Tailwind + shadcn/ui frontend, Cloudflare Workers (Agents SDK) for orchestration & SSE, FastAPI ingest (LangChain) for PDF â†’ embeddings â†’ Vectorize, Cloudflare Vectorize primary, Supabase Auth (Google-only), guardrails, tests, CI, docs, and infra.








/horase-racing-rag
â”œâ”€ .github/
â”‚  â”œâ”€ workflows/
â”‚  â”‚  â”œâ”€ ci-schema-check.yml            # runs ingest service, generates schemas, fails on diff
â”‚  â”‚  â”œâ”€ tests.yml                      # run unit + integration tests (workers + ingest)
â”‚  â”‚  â””â”€ deploy.yml                     # build & deploy to Cloudflare Pages/Workers
â”‚  â””â”€ ISSUE_TEMPLATE.md
â”œâ”€ .vscode/
â”‚  â””â”€ settings.json
â”œâ”€ docs/
â”‚  â”œâ”€ README.md                         # docs hub (quickstart links)
â”‚  â”œâ”€ ARCHITECTURE.md                   # system diagrams + explanations
â”‚  â”œâ”€ API_SPEC.md                        # SSE schema, endpoints, OpenAPI notes
â”‚  â”œâ”€ SECURITY.md                        # threat model, secrets list, rules
â”‚  â”œâ”€ DATA_INGEST.md                     # chunking rules, retention, upsert logic
â”‚  â”œâ”€ PROMPT_LIBRARY.md                  # system prompts + templates
â”‚  â”œâ”€ MODEL_EVAL.md                      # backtest harness, metrics
â”‚  â”œâ”€ ADRs/
â”‚  â”‚  â”œâ”€ 0001-agent-sdk-choice.md
â”‚  â”‚  â”œâ”€ 0002-guardrail-strategy.md
â”‚  â”‚  â””â”€ 0003-vectorstore-choice.md
â”‚  â””â”€ audit/
â”‚     â””â”€ pdf-agent-mapping.md            # annotated mapping of PDF â†’ code (from the guide)
â”œâ”€ infra/
â”‚  â”œâ”€ wrangler.toml                      # Cloudflare Workers config
â”‚  â”œâ”€ wrangler.publish.sh                # helper deploy script
â”‚  â”œâ”€ terraform/                         # optional IaC (if needed later)
â”‚  â””â”€ cloudflare/                        # KV/Vectorize namespace docs & scripts
â”œâ”€ frontend/                             # Vite + TypeScript SPA
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ tsconfig.json
â”‚  â”œâ”€ vite.config.ts
â”‚  â”œâ”€ tailwind.config.cjs
â”‚  â”œâ”€ postcss.config.cjs
â”‚  â”œâ”€ public/
â”‚  â”‚  â””â”€ assets/
â”‚  â”œâ”€ src/
â”‚  â”‚  â”œâ”€ main.tsx
â”‚  â”‚  â”œâ”€ App.tsx
â”‚  â”‚  â”œâ”€ index.css
â”‚  â”‚  â”œâ”€ pages/
â”‚  â”‚  â”‚  â”œâ”€ Home.tsx
â”‚  â”‚  â”‚  â”œâ”€ Story.tsx
â”‚  â”‚  â”‚  â”œâ”€ Pricing.tsx
â”‚  â”‚  â”‚  â”œâ”€ LearnMore.tsx
â”‚  â”‚  â”‚  â”œâ”€ About.tsx
â”‚  â”‚  â”‚  â”œâ”€ RealtimePrediction.tsx      # SSE client + live UI
â”‚  â”‚  â”‚  â””â”€ Admin/
â”‚  â”‚  â”‚     â””â”€ HumanReview.tsx          # small staff UI to approve HITL
â”‚  â”‚  â”œâ”€ components/                    # shadcn/ui + Tailwind components
â”‚  â”‚  â”‚  â”œâ”€ Header.tsx
â”‚  â”‚  â”‚  â”œâ”€ Footer.tsx
â”‚  â”‚  â”‚  â”œâ”€ Navbar.tsx
â”‚  â”‚  â”‚  â”œâ”€ ToggleTheme.tsx
â”‚  â”‚  â”‚  â””â”€ PredictionCard.tsx
â”‚  â”‚  â”œâ”€ lib/
â”‚  â”‚  â”‚  â”œâ”€ api.ts                      # fetch wrappers that talk to Workers
â”‚  â”‚  â”‚  â””â”€ eventsource.ts              # EventSource wrapper and parsing
â”‚  â”‚  â”œâ”€ schemas/                       # generated Zod schemas (git-tracked)
â”‚  â”‚  â”‚  â””â”€ predictions.generated.ts    # generated by tools/gen-schemas.js
â”‚  â”‚  â””â”€ styles/
â”‚  â””â”€ README.md
â”œâ”€ workers/                              # Cloudflare Workers + Agents SDK (TypeScript)
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ tsconfig.worker.json
â”‚  â”œâ”€ src/
â”‚  â”‚  â”œâ”€ entry.ts                        # Hono or Worker entry
â”‚  â”‚  â”œâ”€ api/
â”‚  â”‚  â”‚  â”œâ”€ predict.ts                   # SSE endpoint: baseline, progress, final
â”‚  â”‚  â”‚  â”œâ”€ auth.ts                      # google oauth redirect/callback (PKCE flow helper)
â”‚  â”‚  â”‚  â”œâ”€ races.ts                     # race list / metadata cached in KV
â”‚  â”‚  â”‚  â””â”€ snapshots.ts                 # save/read prediction snapshots
â”‚  â”‚  â”œâ”€ lib/
â”‚  â”‚  â”‚  â”œâ”€ guardrails.ts                # inputGuardrail, tool-risk, moderation helpers
â”‚  â”‚  â”‚  â”œâ”€ vectorize.ts                 # Vectorize query wrapper
â”‚  â”‚  â”‚  â”œâ”€ openai-client.ts             # agent + Responses wrapper (stream)
â”‚  â”‚  â”‚  â”œâ”€ odds-adapters.ts             # adapter pattern for odds providers
â”‚  â”‚  â”‚  â”œâ”€ kv.ts                        # KV helpers
â”‚  â”‚  â”‚  â””â”€ audit.ts                     # writes audit rows to KV/Supabase
â”‚  â”‚  â”œâ”€ tools/                          # definitions that the agent can call
â”‚  â”‚  â”‚  â”œâ”€ tool_query_rag.ts            # lightweight wrapper calling FastAPI /query/rag
â”‚  â”‚  â”‚  â””â”€ tool_fetch_odds.ts
â”‚  â”‚  â””â”€ schemas/                        # zod runtime schemas for worker validation
â”‚  â””â”€ wrangler.toml                      # worker-specific config (bindings)
â”œâ”€ ingest-service/                       # FastAPI (Python) â€” PDF ingestion + LangChain
â”‚  â”œâ”€ pyproject.toml / requirements.txt
â”‚  â”œâ”€ Dockerfile
â”‚  â”œâ”€ app/
â”‚  â”‚  â”œâ”€ main.py                         # FastAPI app entry + health endpoints
â”‚  â”‚  â”œâ”€ schemas.py                      # Pydantic canonical models (source-of-truth)
â”‚  â”‚  â”œâ”€ ingest/
â”‚  â”‚  â”‚  â”œâ”€ pdf_parser.py                # pypdf / pdfminer parsing
â”‚  â”‚  â”‚  â”œâ”€ chunker.py                   # langchain text splitter wrapper
â”‚  â”‚  â”‚  â”œâ”€ embedder.py                  # OpenAI/HF embedding adapter
â”‚  â”‚  â”‚  â””â”€ upsert.py                    # upsert batches to Vectorize
â”‚  â”‚  â”œâ”€ query/
â”‚  â”‚  â”‚  â””â”€ rag_query.py                 # simple RAG endpoint used as tool
â”‚  â”‚  â”œâ”€ guardrails.py                   # ingest-level scrubbing + moderation
â”‚  â”‚  â””â”€ backtest/
â”‚  â”‚     â”œâ”€ backtest.py                  # historical evaluation harness
â”‚  â”‚     â””â”€ datasets/                    # sample CSVs for CI smoke-tests
â”‚  â””â”€ scripts/
â”‚     â”œâ”€ export_schemas.py               # exports pydantic -> jsonschema
â”‚     â””â”€ run_local.sh
â”œâ”€ tools/
â”‚  â”œâ”€ gen-schemas.js                     # fetch openapi -> jsonschema -> zod generated
â”‚  â”œâ”€ seed_data/                         # sample PDFs, CSVs
â”‚  â””â”€ dev_helpers/
â”‚     â””â”€ mock_vectorize_server.js
â”œâ”€ infra-scripts/
â”‚  â”œâ”€ create-kv-namespaces.sh
â”‚  â””â”€ create-vectorize-namespace.sh
â”œâ”€ test/
â”‚  â”œâ”€ frontend/
â”‚  â”‚  â””â”€ ui.test.tsx
â”‚  â”œâ”€ workers/
â”‚  â”‚  â””â”€ guardrails.test.ts
â”‚  â””â”€ ingest-service/
â”‚     â””â”€ test_ingest.py
â”œâ”€ .env.example
â”œâ”€ .gitignore
â”œâ”€ README.md                             # project top-level quickstart + architecture links
â””â”€ LICENSE




Important files & secrets (short cheat-sheet)

workers/wrangler.toml â€” bind KV namespaces and Vectorize keys.

infra/wrangler.publish.sh â€” one-liner to deploy.

.env.example â€” include these env names (DON'T commit real values):

OPENAI_API_KEY

VECTORIZE_KEY

VECTORIZE_UPSERT_URL

VECTORIZE_QUERY_URL

SUPABASE_URL

SUPABASE_SERVICE_KEY

GOOGLE_CLIENT_ID

GOOGLE_CLIENT_SECRET

MAX_STAKE_FRACTION (e.g., 0.05)

Supabase table(s): users, snapshots, human_reviews, audit_predictions (DDL available if needed).

Quick dev scripts (what to add to package.json / pyproject)

frontend/package.json

dev, build, preview, lint, test, gen:schemas (calls tools/gen-schemas.js)

workers/package.json

dev (wrangler dev), build, deploy (wrangler publish)

ingest-service/pyproject

start (uvicorn), docker-build, test

Recommended commit sequence (fast start)

0001/init â€” add folder skeleton + docs + README.

0002/frontend-bootstrap â€” Vite + Tailwind + shadcn setup + placeholder pages.

0003/workers-sse-skeleton â€” SSE endpoint + guardrail schemas + basic agent skeleton.

0004/ingest-stub â€” FastAPI skeleton + PDF sample + chunk/upsert placeholder.

0005/schema-gen â€” add tools/gen-schemas + CI job for schema-check.

0006/guardrails â€” full guardrail middleware + tests.

0007/deploy-pipeline â€” GH Actions deploy & secret setup docs.

âœ… Task list (first sprint)

Scaffold repo (folders + README + docs).

Implement SSE /api/predict skeleton with baseline + event streaming.

Add FastAPI ingest skeleton + sample PDF processing.

Add guardrail schemas (Zod + Pydantic) + CI schema-check.

Wire Supabase Auth (Google-only) quickstart and add secret docs.

ğŸ“‚ Folder structure (final)
(see tree above â€” copy into repo root).

ğŸ” Sprint model (4 sprints, 2-week-ish cadence)

Sprint 0 (3 days): Repo scaffold, docs, secrets list, quick HMR dev flow.

Sprint 1 (7 days): Frontend UI (Vite), SSE client, basic worker SSE skeleton, Google auth integration.

Sprint 2 (7 days): Ingest pipeline (PDF â†’ chunk â†’ embed â†’ Vectorize), query tool, RAG integration.

Sprint 3 (7 days): OpenAI Agents SDK integration, full guardrails, HITL UI, CI, deploy, monitoring.

ğŸ§  Architecture (one-liner)
Edge-first RAG: Vite UI â†’ Cloudflare Worker (Auth + Agent orchestration + SSE) â†’ FastAPI (Ingest & RAG tools) â†’ Cloudflare Vectorize â†’ OpenAI models, with Supabase Auth and audit/HITL flows.