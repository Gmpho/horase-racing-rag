Final Project Folder Structure — production-ready, edge-first, guardrail-first 📂⚡️

Nice — here’s a complete, opinionated repo layout you can drop into your horase-racing-rag repo. It matches everything we agreed: Vite + TS + Tailwind + shadcn/ui frontend, Cloudflare Workers (Agents SDK) for orchestration & SSE, FastAPI ingest (LangChain) for PDF → embeddings → Vectorize, Cloudflare Vectorize primary, Supabase Auth (Google-only), guardrails, tests, CI, docs, and infra.








/horase-racing-rag
├─ .github/
│  ├─ workflows/
│  │  ├─ ci-schema-check.yml            # runs ingest service, generates schemas, fails on diff
│  │  ├─ tests.yml                      # run unit + integration tests (workers + ingest)
│  │  └─ deploy.yml                     # build & deploy to Cloudflare Pages/Workers
│  └─ ISSUE_TEMPLATE.md
├─ .vscode/
│  └─ settings.json
├─ docs/
│  ├─ README.md                         # docs hub (quickstart links)
│  ├─ ARCHITECTURE.md                   # system diagrams + explanations
│  ├─ API_SPEC.md                        # SSE schema, endpoints, OpenAPI notes
│  ├─ SECURITY.md                        # threat model, secrets list, rules
│  ├─ DATA_INGEST.md                     # chunking rules, retention, upsert logic
│  ├─ PROMPT_LIBRARY.md                  # system prompts + templates
│  ├─ MODEL_EVAL.md                      # backtest harness, metrics
│  ├─ ADRs/
│  │  ├─ 0001-agent-sdk-choice.md
│  │  ├─ 0002-guardrail-strategy.md
│  │  └─ 0003-vectorstore-choice.md
│  └─ audit/
│     └─ pdf-agent-mapping.md            # annotated mapping of PDF → code (from the guide)
├─ infra/
│  ├─ wrangler.toml                      # Cloudflare Workers config
│  ├─ wrangler.publish.sh                # helper deploy script
│  ├─ terraform/                         # optional IaC (if needed later)
│  └─ cloudflare/                        # KV/Vectorize namespace docs & scripts
├─ frontend/                             # Vite + TypeScript SPA
│  ├─ package.json
│  ├─ tsconfig.json
│  ├─ vite.config.ts
│  ├─ tailwind.config.cjs
│  ├─ postcss.config.cjs
│  ├─ public/
│  │  └─ assets/
│  ├─ src/
│  │  ├─ main.tsx
│  │  ├─ App.tsx
│  │  ├─ index.css
│  │  ├─ pages/
│  │  │  ├─ Home.tsx
│  │  │  ├─ Story.tsx
│  │  │  ├─ Pricing.tsx
│  │  │  ├─ LearnMore.tsx
│  │  │  ├─ About.tsx
│  │  │  ├─ RealtimePrediction.tsx      # SSE client + live UI
│  │  │  └─ Admin/
│  │  │     └─ HumanReview.tsx          # small staff UI to approve HITL
│  │  ├─ components/                    # shadcn/ui + Tailwind components
│  │  │  ├─ Header.tsx
│  │  │  ├─ Footer.tsx
│  │  │  ├─ Navbar.tsx
│  │  │  ├─ ToggleTheme.tsx
│  │  │  └─ PredictionCard.tsx
│  │  ├─ lib/
│  │  │  ├─ api.ts                      # fetch wrappers that talk to Workers
│  │  │  └─ eventsource.ts              # EventSource wrapper and parsing
│  │  ├─ schemas/                       # generated Zod schemas (git-tracked)
│  │  │  └─ predictions.generated.ts    # generated by tools/gen-schemas.js
│  │  └─ styles/
│  └─ README.md
├─ workers/                              # Cloudflare Workers + Agents SDK (TypeScript)
│  ├─ package.json
│  ├─ tsconfig.worker.json
│  ├─ src/
│  │  ├─ entry.ts                        # Hono or Worker entry
│  │  ├─ api/
│  │  │  ├─ predict.ts                   # SSE endpoint: baseline, progress, final
│  │  │  ├─ auth.ts                      # google oauth redirect/callback (PKCE flow helper)
│  │  │  ├─ races.ts                     # race list / metadata cached in KV
│  │  │  └─ snapshots.ts                 # save/read prediction snapshots
│  │  ├─ lib/
│  │  │  ├─ guardrails.ts                # inputGuardrail, tool-risk, moderation helpers
│  │  │  ├─ vectorize.ts                 # Vectorize query wrapper
│  │  │  ├─ openai-client.ts             # agent + Responses wrapper (stream)
│  │  │  ├─ odds-adapters.ts             # adapter pattern for odds providers
│  │  │  ├─ kv.ts                        # KV helpers
│  │  │  └─ audit.ts                     # writes audit rows to KV/Supabase
│  │  ├─ tools/                          # definitions that the agent can call
│  │  │  ├─ tool_query_rag.ts            # lightweight wrapper calling FastAPI /query/rag
│  │  │  └─ tool_fetch_odds.ts
│  │  └─ schemas/                        # zod runtime schemas for worker validation
│  └─ wrangler.toml                      # worker-specific config (bindings)
├─ ingest-service/                       # FastAPI (Python) — PDF ingestion + LangChain
│  ├─ pyproject.toml / requirements.txt
│  ├─ Dockerfile
│  ├─ app/
│  │  ├─ main.py                         # FastAPI app entry + health endpoints
│  │  ├─ schemas.py                      # Pydantic canonical models (source-of-truth)
│  │  ├─ ingest/
│  │  │  ├─ pdf_parser.py                # pypdf / pdfminer parsing
│  │  │  ├─ chunker.py                   # langchain text splitter wrapper
│  │  │  ├─ embedder.py                  # OpenAI/HF embedding adapter
│  │  │  └─ upsert.py                    # upsert batches to Vectorize
│  │  ├─ query/
│  │  │  └─ rag_query.py                 # simple RAG endpoint used as tool
│  │  ├─ guardrails.py                   # ingest-level scrubbing + moderation
│  │  └─ backtest/
│  │     ├─ backtest.py                  # historical evaluation harness
│  │     └─ datasets/                    # sample CSVs for CI smoke-tests
│  └─ scripts/
│     ├─ export_schemas.py               # exports pydantic -> jsonschema
│     └─ run_local.sh
├─ tools/
│  ├─ gen-schemas.js                     # fetch openapi -> jsonschema -> zod generated
│  ├─ seed_data/                         # sample PDFs, CSVs
│  └─ dev_helpers/
│     └─ mock_vectorize_server.js
├─ infra-scripts/
│  ├─ create-kv-namespaces.sh
│  └─ create-vectorize-namespace.sh
├─ test/
│  ├─ frontend/
│  │  └─ ui.test.tsx
│  ├─ workers/
│  │  └─ guardrails.test.ts
│  └─ ingest-service/
│     └─ test_ingest.py
├─ .env.example
├─ .gitignore
├─ README.md                             # project top-level quickstart + architecture links
└─ LICENSE




Important files & secrets (short cheat-sheet)

workers/wrangler.toml — bind KV namespaces and Vectorize keys.

infra/wrangler.publish.sh — one-liner to deploy.

.env.example — include these env names (DON'T commit real values):

OPENAI_API_KEY

VECTORIZE_KEY

VECTORIZE_UPSERT_URL

VECTORIZE_QUERY_URL

SUPABASE_URL

SUPABASE_SERVICE_KEY

GOOGLE_CLIENT_ID

GOOGLE_CLIENT_SECRET

MAX_STAKE_FRACTION (e.g., 0.05)

Supabase table(s): users, snapshots, human_reviews, audit_predictions (DDL available if needed).

Quick dev scripts (what to add to package.json / pyproject)

frontend/package.json

dev, build, preview, lint, test, gen:schemas (calls tools/gen-schemas.js)

workers/package.json

dev (wrangler dev), build, deploy (wrangler publish)

ingest-service/pyproject

start (uvicorn), docker-build, test

Recommended commit sequence (fast start)

0001/init — add folder skeleton + docs + README.

0002/frontend-bootstrap — Vite + Tailwind + shadcn setup + placeholder pages.

0003/workers-sse-skeleton — SSE endpoint + guardrail schemas + basic agent skeleton.

0004/ingest-stub — FastAPI skeleton + PDF sample + chunk/upsert placeholder.

0005/schema-gen — add tools/gen-schemas + CI job for schema-check.

0006/guardrails — full guardrail middleware + tests.

0007/deploy-pipeline — GH Actions deploy & secret setup docs.

✅ Task list (first sprint)

Scaffold repo (folders + README + docs).

Implement SSE /api/predict skeleton with baseline + event streaming.

Add FastAPI ingest skeleton + sample PDF processing.

Add guardrail schemas (Zod + Pydantic) + CI schema-check.

Wire Supabase Auth (Google-only) quickstart and add secret docs.

📂 Folder structure (final)
(see tree above — copy into repo root).

🔁 Sprint model (4 sprints, 2-week-ish cadence)

Sprint 0 (3 days): Repo scaffold, docs, secrets list, quick HMR dev flow.

Sprint 1 (7 days): Frontend UI (Vite), SSE client, basic worker SSE skeleton, Google auth integration.

Sprint 2 (7 days): Ingest pipeline (PDF → chunk → embed → Vectorize), query tool, RAG integration.

Sprint 3 (7 days): OpenAI Agents SDK integration, full guardrails, HITL UI, CI, deploy, monitoring.

🧠 Architecture (one-liner)
Edge-first RAG: Vite UI → Cloudflare Worker (Auth + Agent orchestration + SSE) → FastAPI (Ingest & RAG tools) → Cloudflare Vectorize → OpenAI models, with Supabase Auth and audit/HITL flows.